@* Live output panel for job execution output *@

<div class="card mb-3 mb-lg-4 h-100 d-flex flex-column">
	<div class="card-header bg-body-secondary d-flex justify-content-between align-items-center flex-wrap gap-2">
		<div class="d-flex align-items-center">
			<span class="live-indicator me-2"></span>
			<strong>Live Output</strong>
			<span class="text-body-secondary ms-2 small">(@OutputLines.Count lines)</span>
		</div>
		<ActionButton Icon="trash" Text="Clear" Size="ActionButton.ButtonSize.Small" HideTextOnMobile="true"
					  OnClick="OnClear" />
	</div>
	<div class="card-body p-0 flex-grow-1 overflow-hidden">
		<div class="terminal-output h-100 p-3 overflow-auto small" @ref="_outputContainer" style="min-height: 300px;">
			@foreach (var line in OutputLines.TakeLast(MaxLines))
			{
				<div class="output-line d-flex gap-2 py-0 @(line.IsError ? "output-error" : "output-stdout")">
					<span class="output-time flex-shrink-0 small d-none d-sm-inline">[@line.Timestamp.FormatTime()]</span>
					<span class="output-text text-break">@line.Content</span>
				</div>
			}
		</div>
	</div>
</div>

@code {
	[Parameter]
	public List<OutputLine> OutputLines { get; set; } = new();

	[Parameter]
	public int MaxLines { get; set; } = 500;

	[Parameter]
	public EventCallback OnClear { get; set; }

	private ElementReference _outputContainer;

	/// <summary>
	/// Output line model
	/// </summary>
	public class OutputLine
	{
		public string Content { get; set; } = string.Empty;
		public bool IsError { get; set; }
		public DateTime Timestamp { get; set; }
	}
}