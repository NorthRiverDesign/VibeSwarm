@* Default model selection modal for providers *@

<ModalDialog @bind-IsVisible="IsVisible" Title="Select Default Model" Icon="star" Size="ModalDialog.ModalSize.Default"
	OnClose="HandleClose">
	<ChildContent>
		@if (Provider != null)
		{
			<p class="text-body-secondary mb-3">
				Choose a default model for <strong>@Provider.Name</strong>.
				This model will be pre-selected when creating new jobs.
			</p>

			@if (IsLoading)
			{
				<div class="d-flex justify-content-center py-4">
					<div class="spinner-border text-primary" role="status">
						<span class="visually-hidden">Loading models...</span>
					</div>
				</div>
			}
			else if (!Models.Any())
			{
				<Alert Type="Alert.AlertType.Info" Message="No models available. Try refreshing the model list first."
					Class="mb-0" />
			}
			else
			{
				<div class="list-group">
					@foreach (var model in Models.Where(m => m.IsAvailable))
					{
						<button type="button"
							class="list-group-item list-group-item-action d-flex align-items-center gap-3 @(model.IsDefault ? "active" : "")"
							@onclick="@(() => SelectModel(model))" disabled="@IsSelecting">
							<div class="flex-grow-1">
								<div class="fw-medium">@(model.DisplayName ?? model.ModelId)</div>
								@if (!string.IsNullOrEmpty(model.Description))
								{
									<small class="@(model.IsDefault ? "" : "text-body-secondary")">@model.Description</small>
								}
								<small class="@(model.IsDefault ? "" : "text-body-tertiary") d-block">@model.ModelId</small>
							</div>
							@if (model.IsDefault)
							{
								<i class="bi bi-check-circle-fill text-white"></i>
							}
							else if (model.PriceMultiplier.HasValue)
							{
								<span class="badge bg-secondary-subtle text-secondary-emphasis">
									@(model.PriceMultiplier.Value)x
								</span>
							}
						</button>
					}
				</div>
			}
		}
	</ChildContent>
	<FooterContent>
		<button type="button" class="btn btn-secondary" @onclick="HandleClose">Close</button>
	</FooterContent>
</ModalDialog>

@code {
	[Parameter]
	public bool IsVisible { get; set; }

	[Parameter]
	public EventCallback<bool> IsVisibleChanged { get; set; }

	[Parameter]
	public Provider? Provider { get; set; }

	[Parameter]
	public List<ProviderModel> Models { get; set; } = new();

	[Parameter]
	public bool IsLoading { get; set; }

	[Parameter]
	public bool IsSelecting { get; set; }

	[Parameter]
	public EventCallback<ProviderModel> OnModelSelected { get; set; }

	[Parameter]
	public EventCallback OnClose { get; set; }

	private async Task SelectModel(ProviderModel model)
	{
		await OnModelSelected.InvokeAsync(model);
	}

	private async Task HandleClose()
	{
		await IsVisibleChanged.InvokeAsync(false);
		await OnClose.InvokeAsync();
	}
}