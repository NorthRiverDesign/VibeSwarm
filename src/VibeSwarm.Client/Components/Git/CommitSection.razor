@* Commit and push section component *@

<div class="card mb-3 mb-lg-4">
	<div class="card-header bg-body-secondary d-flex justify-content-between align-items-center">
		<div class="d-flex align-items-center">
			<i class="bi bi-cloud-upload me-2 opacity-75"></i>
			<strong>Commit</strong>
		</div>
		@if (!string.IsNullOrEmpty(BranchName) && !IsPushed && !IsAutoCommitted)
		{
			<span class="branch-info d-inline-flex align-items-center gap-1 py-1 px-2 rounded-1 small text-truncate">
				<i class="bi bi-diagram-2 me-1"></i>
				@BranchName
			</span>
		}
		@if (IsAutoCommitted)
		{
			<span class="badge bg-success d-inline-flex align-items-center gap-1">
				<i class="bi bi-robot"></i>
				<span>Auto-committed</span>
			</span>
		}
	</div>
	@if (!IsPushed && !IsAutoCommitted)
	{
		<div class="card-body">
			<label for="commitMessage" class="form-label d-flex flex-wrap align-items-center gap-2 mb-2">
				<span>Commit Message</span>
				@if (IsLoadingSummary)
				{
					<span class="badge bg-secondary">
						<span class="spinner-border spinner-border-sm me-1" role="status"
							  style="width: 0.75rem; height: 0.75rem;"></span>
						Generating...
					</span>
				}
				else if (HasAISummary)
				{
					<span class="badge bg-info">
						<i class="bi bi-robot me-1"></i>AI Generated
					</span>
				}
			</label>
			<textarea id="commitMessage" class="form-control w-100" @bind="CommitMessage" @bind:event="oninput"
					  placeholder="@(IsLoadingSummary ? "Generating commit message..." : "Enter a descriptive commit message...")"
					  rows="3" disabled="@IsPushing"></textarea>

			@if (!string.IsNullOrEmpty(SummaryError))
			{
				<Alert Type="Alert.AlertType.Warning" Class="mt-2 mb-0 py-2 px-3 small">
					@SummaryError
					<button type="button" class="btn btn-sm btn-outline-warning ms-2" @onclick="OnRefreshSummary">
						<i class="bi bi-arrow-repeat"></i> Retry
					</button>
				</Alert>
			}

			@if (!string.IsNullOrEmpty(PushError))
			{
				<Alert Type="Alert.AlertType.Danger" ShowIcon="true" Class="mt-3 mb-0">
					@PushError
				</Alert>
			}
		</div>
		<div class="card-footer bg-body-secondary">
			<button class="btn btn-primary" @onclick="OnCommitAndPush" disabled="@(!CanPush || IsPushing)">
				@if (IsPushing)
				{
					<span class="spinner-border spinner-border-sm me-1" role="status"></span>
					<span class="d-none d-sm-inline">@PushStatus</span>
					<span class="d-sm-none">Pushing...</span>
				}
				else
				{
					<i class="bi bi-cloud-upload me-1"></i>
					<span>Commit & Push</span>
				}
			</button>
		</div>
	}
	else if (IsAutoCommitted)
	{
		<div class="card-body p-3">
			<div class="d-flex align-items-center gap-2 mb-2">
				<i class="bi bi-check-circle-fill text-success"></i>
				<strong>Changes auto-committed!</strong>
			</div>
			<div class="d-flex flex-wrap gap-2 mb-2">
				@if (!string.IsNullOrEmpty(PushedCommitHash))
				{
					<span class="badge bg-body-tertiary text-body font-monospace">
						<i class="bi bi-git me-1"></i>@PushedCommitHash[..Math.Min(7, PushedCommitHash.Length)]
					</span>
				}
				@if (!string.IsNullOrEmpty(BranchName))
				{
					<span class="badge bg-body-tertiary text-body font-monospace">
						<i class="bi bi-diagram-2 me-1"></i>@BranchName
					</span>
				}
			</div>
			@if (!string.IsNullOrEmpty(CommitMessageUsed))
			{
				<div class="bg-body-tertiary rounded p-2 small text-body-secondary" style="white-space: pre-wrap;">
					@CommitMessageUsed</div>
				}
			</div>
		}
	else
		{
			<div class="card-body p-3">
				<div class="d-flex align-items-center gap-2 mb-2">
					<i class="bi bi-check-circle-fill text-success"></i>
					<strong>Changes pushed successfully!</strong>
				</div>
				<div class="d-flex flex-wrap gap-2 mb-2">
					@if (!string.IsNullOrEmpty(PushedCommitHash))
					{
						<span class="badge bg-body-tertiary text-body font-monospace">
							<i class="bi bi-git me-1"></i>@PushedCommitHash[..Math.Min(7, PushedCommitHash.Length)]
						</span>
					}
					@if (!string.IsNullOrEmpty(BranchName))
					{
						<span class="badge bg-body-tertiary text-body font-monospace">
							<i class="bi bi-diagram-2 me-1"></i>@BranchName
						</span>
					}
				</div>
				@if (!string.IsNullOrEmpty(CommitMessageUsed))
				{
					<div class="bg-body-tertiary rounded p-2 small text-body-secondary" style="white-space: pre-wrap;">
						@CommitMessageUsed</div>
					}
				</div>
			}
		</div>

@code {
	[Parameter]
	public string CommitMessage { get; set; } = string.Empty;

	[Parameter]
	public EventCallback<string> CommitMessageChanged { get; set; }

	[Parameter]
	public string? BranchName { get; set; }

	[Parameter]
	public bool IsLoadingSummary { get; set; }

	[Parameter]
	public bool HasAISummary { get; set; }

	[Parameter]
	public string? SummaryError { get; set; }

	[Parameter]
	public string? PushError { get; set; }

	[Parameter]
	public bool IsPushing { get; set; }

	[Parameter]
	public string PushStatus { get; set; } = "Pushing...";

	[Parameter]
	public bool IsPushed { get; set; }

	[Parameter]
	public string? PushedCommitHash { get; set; }

	[Parameter]
	public bool CanPush { get; set; }

	[Parameter]
	public bool IsAutoCommitted { get; set; }

	[Parameter]
	public string? CommitMessageUsed { get; set; }

	[Parameter]
	public EventCallback OnCommitAndPush { get; set; }

	[Parameter]
	public EventCallback OnRefreshSummary { get; set; }
}