@* Reusable job card component for job listings *@
@using VibeSwarm.Shared.Utilities

<div class="card h-100 border-start border-info border-3 cursor-pointer job-card-hover" @onclick="HandleClick">
	<div class="card-body p-3">
		<div class="d-flex justify-content-between align-items-start gap-2 flex-wrap mb-2">
			<div class="d-flex align-items-center gap-2 flex-wrap">
				<StatusBadge Status="@Status" />
				@if (IsCancelling)
				{
					<StatusBadge Status="Cancelling" />
				}
			</div>
			<span class="text-body-secondary small fw-medium">@ProjectName</span>
		</div>

		<p class="mb-2 text-truncate-lines-3 small">@TruncateText(Prompt, 120)</p>

		<div class="d-flex flex-wrap align-items-center gap-2 pt-2 border-top small text-body-secondary">
			<span class="fw-medium">@ProviderName</span>
			@if (!string.IsNullOrEmpty(ModelUsed))
			{
				<span class="badge bg-secondary-subtle text-secondary-emphasis">@FormatModelName(ModelUsed)</span>
			}
			@if (!string.IsNullOrEmpty(Activity))
			{
				<span class="text-info fst-italic text-truncate" style="max-width: 150px;">@Activity</span>
			}
			else if (!string.IsNullOrEmpty(TimeDisplay))
			{
				<span class="text-body-tertiary">@TimeDisplay</span>
			}
			<span class="ms-auto d-flex align-items-center gap-2">
				@if (InputTokens.HasValue || OutputTokens.HasValue)
				{
					<span class="font-monospace text-body-secondary" title="Input / Output tokens">
						@TokenHelper.FormatTokenCount(InputTokens ?? 0) / @TokenHelper.FormatTokenCount(OutputTokens ?? 0)
					</span>
				}
				@if (Cost.HasValue)
				{
					<span class="font-monospace fw-medium text-success">@TokenHelper.FormatCost(Cost.Value)</span>
				}
			</span>
		</div>
	</div>
</div>

@code {
	[Parameter]
	public string Status { get; set; } = string.Empty;

	[Parameter]
	public bool IsCancelling { get; set; }

	[Parameter]
	public string ProjectName { get; set; } = "Unknown";

	[Parameter]
	public string ProviderName { get; set; } = "Unknown";

	[Parameter]
	public string Prompt { get; set; } = string.Empty;

	[Parameter]
	public string? Activity { get; set; }

	[Parameter]
	public string? TimeDisplay { get; set; }

	[Parameter]
	public decimal? Cost { get; set; }

	[Parameter]
	public int? InputTokens { get; set; }

	[Parameter]
	public int? OutputTokens { get; set; }

	[Parameter]
	public string? ModelUsed { get; set; }

	[Parameter]
	public EventCallback OnClick { get; set; }

	private async Task HandleClick()
	{
		await OnClick.InvokeAsync();
	}

	private static string TruncateText(string text, int maxLength)
	{
		if (string.IsNullOrEmpty(text) || text.Length <= maxLength)
			return text;
		return text[..maxLength] + "...";
	}

	private static string FormatModelName(string model)
	{
		// Shorten long model names like "claude-sonnet-4-20250514" to "sonnet-4"
		if (model.Contains("claude-"))
		{
			var parts = model.Replace("claude-", "").Split('-');
			if (parts.Length >= 2)
			{
				return $"{parts[0]}-{parts[1]}";
			}
		}
		// For other models, truncate if too long
		return model.Length > 20 ? model[..17] + "..." : model;
	}
}