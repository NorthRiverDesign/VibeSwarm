@* Reusable job card component for job listings *@

<div class="card h-100 border-start border-info border-3 cursor-pointer job-card-hover" @onclick="HandleClick">
	<div class="card-body p-3">
		<div class="d-flex justify-content-between align-items-start gap-2 flex-wrap mb-2">
			<div class="d-flex align-items-center gap-2 flex-wrap">
				<StatusBadge Status="@Status" />
				@if (IsCancelling)
				{
					<StatusBadge Status="Cancelling" />
				}
			</div>
			<span class="text-body-secondary small fw-medium">@ProjectName</span>
		</div>

		<p class="mb-2 text-truncate-lines-3 small">@TruncateText(Prompt, 120)</p>

		<div class="d-flex flex-wrap align-items-center gap-2 pt-2 border-top small text-body-secondary">
			<span class="fw-medium">@ProviderName</span>
			@if (!string.IsNullOrEmpty(Activity))
			{
				<span class="text-info fst-italic text-truncate" style="max-width: 150px;">@Activity</span>
			}
			else if (!string.IsNullOrEmpty(TimeDisplay))
			{
				<span class="text-body-tertiary">@TimeDisplay</span>
			}
			@if (Cost.HasValue)
			{
				<span class="ms-auto font-monospace fw-medium text-success">@TokenHelper.FormatCost(Cost.Value)</span>
			}
		</div>
	</div>
</div>

@code {
	[Parameter]
	public string Status { get; set; } = string.Empty;

	[Parameter]
	public bool IsCancelling { get; set; }

	[Parameter]
	public string ProjectName { get; set; } = "Unknown";

	[Parameter]
	public string ProviderName { get; set; } = "Unknown";

	[Parameter]
	public string Prompt { get; set; } = string.Empty;

	[Parameter]
	public string? Activity { get; set; }

	[Parameter]
	public string? TimeDisplay { get; set; }

	[Parameter]
	public decimal? Cost { get; set; }

	[Parameter]
	public EventCallback OnClick { get; set; }

	private async Task HandleClick()
	{
		await OnClick.InvokeAsync();
	}

	private static string TruncateText(string text, int maxLength)
	{
		if (string.IsNullOrEmpty(text) || text.Length <= maxLength)
			return text;
		return text[..maxLength] + "...";
	}
}