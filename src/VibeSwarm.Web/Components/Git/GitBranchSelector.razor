@* Git branch selector dropdown component *@
@using VibeSwarm.Shared.VersionControl.Models

@if (Branches.Any())
{
	<div class="dropdown">
		<button class="btn btn-sm bg-body-tertiary border d-flex align-items-center gap-2 dropdown-toggle" type="button"
			data-bs-toggle="dropdown" aria-expanded="false" disabled="@(IsDisabled || !Branches.Any())"
			title="Current branch">
			<i class="bi bi-git text-danger"></i>
			<span class="fw-medium">@(CurrentBranch ?? "No branch")</span>
			@if (!string.IsNullOrEmpty(CurrentCommitHash))
			{
				<span class="font-monospace text-body-secondary small">@CurrentCommitHash[..Math.Min(7,
								CurrentCommitHash.Length)]</span>
				}
		</button>
		<ul class="dropdown-menu dropdown-menu-end" style="max-height: 300px; overflow-y: auto;">
			<li>
				<h6 class="dropdown-header">Local Branches</h6>
			</li>
			@foreach (var branch in Branches.Where(b => !b.IsRemote))
			{
				var isCurrentBranch = branch.Name == CurrentBranch;
				<li>
					<button class="dropdown-item d-flex align-items-center gap-2 @(isCurrentBranch ? "active" : "")"
						@onclick="@(() => OnBranchSelected.InvokeAsync(branch.Name))" disabled="@isCurrentBranch">
						@if (isCurrentBranch)
						{
							<i class="bi bi-check-lg"></i>
						}
						else
						{
							<i class="bi bi-git opacity-50"></i>
						}
						<span>@branch.Name</span>
					</button>
				</li>
			}
			@if (Branches.Any(b => b.IsRemote))
			{
				<li>
					<hr class="dropdown-divider">
				</li>
				<li>
					<h6 class="dropdown-header">Remote Branches</h6>
				</li>
				@foreach (var branch in Branches.Where(b => b.IsRemote))
				{
					<li>
						<button class="dropdown-item d-flex align-items-center gap-2"
							@onclick="@(() => OnBranchSelected.InvokeAsync(branch.ShortName))">
							<i class="bi bi-cloud opacity-50"></i>
							<span>@branch.Name</span>
						</button>
					</li>
				}
			}
		</ul>
	</div>
}
else if (!string.IsNullOrEmpty(CurrentBranch))
{
	<span class="badge bg-body-tertiary text-body d-flex align-items-center gap-1">
		<i class="bi bi-git text-danger"></i>
		@CurrentBranch
	</span>
}

@code {
	[Parameter]
	public List<GitBranchInfo> Branches { get; set; } = new();

	[Parameter]
	public string? CurrentBranch { get; set; }

	[Parameter]
	public string? CurrentCommitHash { get; set; }

	[Parameter]
	public bool IsDisabled { get; set; }

	[Parameter]
	public EventCallback<string> OnBranchSelected { get; set; }
}