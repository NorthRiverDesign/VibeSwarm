@* Conversation messages container component *@

<div class="card">
	<div class="card-header bg-body-secondary d-flex justify-content-between align-items-center">
		<h5 class="mb-0 fw-semibold"><i class="bi bi-chat-dots me-2 opacity-75"></i>Conversation</h5>
		<span class="badge bg-secondary">@Messages.Count</span>
	</div>
	<div class="card-body p-2 p-sm-3">
		@if (IsActive)
		{
			<div class="activity-indicator mb-3">
				<span class="activity-spinner"></span>
				<span class="activity-text">@(CurrentActivity ?? "Working...")</span>
				@if (LastActivityAt.HasValue)
				{
					<span class="activity-time">@LastActivityAt.Value.FormatTime()</span>
				}
			</div>
		}

		@if (!Messages.Any())
		{
			<div class="empty-state">
				@if (Status == JobStatus.New || Status == JobStatus.Pending)
				{
					<text>Job is waiting to be processed...</text>
				}
				else if (Status == JobStatus.Started || Status == JobStatus.Processing)
				{
					<text>Agent is working on the task...</text>
				}
				else
				{
					<text>No conversation messages recorded.</text>
				}
			</div>
		}
		else
		{
			<div class="chat-messages-container">
				@foreach (var message in Messages)
				{
					<ChatMessage Role="@message.Role" Content="@message.Content" ToolName="@message.ToolName"
						ToolInput="@message.ToolInput" ToolOutput="@message.ToolOutput" Timestamp="@message.CreatedAt" />
				}
			</div>
		}
	</div>
</div>

@code {
	[Parameter]
	public List<JobMessage> Messages { get; set; } = new();

	[Parameter]
	public JobStatus Status { get; set; }

	[Parameter]
	public bool IsActive { get; set; }

	[Parameter]
	public string? CurrentActivity { get; set; }

	[Parameter]
	public DateTime? LastActivityAt { get; set; }
}