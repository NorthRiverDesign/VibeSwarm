@inject NavigationManager NavigationManager

@code {
	protected override void OnInitialized()
	{
		// Get the current URI but avoid redirect loops
		var currentUri = NavigationManager.Uri;
		var baseUri = NavigationManager.BaseUri;
		var relativePath = currentUri.Replace(baseUri, "/");

		// Don't include login-related pages in the return URL to avoid loops
		if (relativePath.StartsWith("/login", StringComparison.OrdinalIgnoreCase) ||
		relativePath.StartsWith("/logout", StringComparison.OrdinalIgnoreCase) ||
		relativePath.StartsWith("/access-denied", StringComparison.OrdinalIgnoreCase))
		{
			NavigationManager.NavigateTo("/login", forceLoad: true);
		}
		else
		{
			var returnUrl = Uri.EscapeDataString(relativePath);
			NavigationManager.NavigateTo($"/login?ReturnUrl={returnUrl}", forceLoad: true);
		}
	}
}